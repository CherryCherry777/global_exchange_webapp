{% extends 'webapp/base.html' %}
{% load static %}

{% block title %}Asignar Clientes a Usuarios{% endblock %}

{% block content %}
<div class="admin-page-container assign-user">
    <!-- Header moderno -->
    <div class="admin-header">
        <div class="header-content">
            <div class="header-left">
                <a href="{% url 'landing' %}" class="back-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Volver al Panel de Administración
                </a>
                <h1 class="page-title">Asignar Clientes a Usuarios</h1>
                <p class="page-subtitle">Gestiona las asignaciones entre clientes y usuarios del sistema</p>
            </div>
        </div>
    </div>

    <!-- Formulario de asignación -->
    <div class="assign-form-container">
        <div class="assign-form-card">
            <h2 class="form-section-title">Nueva Asignación</h2>
            
            <form method="post" class="assign-form">
                {% csrf_token %}
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="{{ form.cliente.id_for_label }}" class="form-label">
                            {{ form.cliente.label }}
                        </label>
                        {{ form.cliente }}
                        {% if form.cliente.errors %}
                            <div class="form-error">{{ form.cliente.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.usuario.id_for_label }}" class="form-label">
                            {{ form.usuario.label }}
                        </label>
                        {{ form.usuario }}
                        {% if form.usuario.errors %}
                            <div class="form-error">{{ form.usuario.errors }}</div>
                        {% endif %}
                    </div>
                </div>

                {% if form.non_field_errors %}
                    <div class="form-error">
                        {% for error in form.non_field_errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}

                <div class="form-actions">
                    <button type="submit" class="modern-btn primary-btn">
                        Asignar Cliente
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Lista de asignaciones existentes -->
    <div class="assignments-container">
        <div class="assignments-card">
            <h2 class="form-section-title">Asignaciones Existentes</h2>

            {% if asignaciones %}
                <div class="assignments-table-container">
                    <table class="assignments-table">
                        <thead>
                            <tr>
                                <th>
                                    <div class="th-content">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="12" cy="7" r="4"></circle>
                                        </svg>
                                        Cliente
                                    </div>
                                </th>
                                <th>
                                    <div class="th-content">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="8.5" cy="7" r="4"></circle>
                                            <line x1="20" y1="8" x2="20" y2="14"></line>
                                            <line x1="23" y1="11" x2="17" y2="11"></line>
                                        </svg>
                                        Usuario
                                    </div>
                                </th>
                                <th>
                                    <div class="th-content">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                            <line x1="16" y1="2" x2="16" y2="6"></line>
                                            <line x1="8" y1="2" x2="8" y2="6"></line>
                                            <line x1="3" y1="10" x2="21" y2="10"></line>
                                        </svg>
                                        Fecha de Asignación
                                    </div>
                                </th>
                                <th>
                                    <div class="th-content">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="3"></circle>
                                            <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1"></path>
                                        </svg>
                                        Acciones
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for asignacion in asignaciones %}
                                <tr>
                                    <td>
                                        <div class="client-info">
                                            <div class="client-avatar">
                                                <span>{{ asignacion.cliente.nombre|first|upper }}</span>
                                            </div>
                                            <div class="client-details">
                                                <div class="client-name">{{ asignacion.cliente.nombre }}</div>
                                                <div class="client-type">{{ asignacion.cliente.get_tipoCliente_display }} - {{ asignacion.cliente.categoria.nombre }}</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="user-info">
                                            <div class="user-avatar">
                                                <span>{{ asignacion.usuario.username|first|upper }}</span>
                                            </div>
                                            <div class="user-details">
                                                <div class="user-name">{{ asignacion.usuario.username }}</div>
                                                <div class="user-email">{{ asignacion.usuario.email }}</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="date-cell">{{ asignacion.fecha_asignacion|date:"d/m/Y H:i" }}</td>
                                    <td>
                                        <a href="{% url 'desasignar_cliente_usuario' asignacion.id %}"
                                           class="action-btn remove-btn"
                                           onclick="return confirm('¿Está seguro de que desea desasignar este cliente del usuario?')">
                                            Desasignar
                                        </a>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-content">
                        <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="8.5" cy="7" r="4"></circle>
                            <line x1="20" y1="8" x2="20" y2="14"></line>
                            <line x1="23" y1="11" x2="17" y2="11"></line>
                        </svg>
                        <h3>No hay asignaciones registradas</h3>
                        <p>Comienza creando tu primera asignación de cliente a usuario</p>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

{% endblock %}
