{% extends "webapp/base.html" %}
{% load static %}

{% block title %}Transacciones - Global Exchange{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'webapp/css/compraventa_y_conversion/historial_transacciones.css' %}?v=1.0">
{% endblock %}

{% block content %}
<!-- Header Section -->
<div class="transactions-header">
    <div class="header-content">
        <a href="{% url 'public_home' %}" class="back-button">← Volver al Inicio</a>
        <h1 class="transactions-title">Transacciones</h1>
        <p class="transactions-subtitle">Visualiza el listado de transacciones</p>
    </div>
</div>

<!-- Main Content -->
<div class="main-content">
    <!-- Transactions List Container -->
    <div class="transactions-list-container">
        <div class="transactions-list-header">
            <h2 class="list-title">Lista de Transacciones</h2>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Buscar Transacción" id="searchInput">
            </div>
        </div>
        
        <!-- Transactions Table -->
        <div class="transactions-table-container">
            <table class="transactions-table">
                <thead>
                    <tr>
                        <th>Transacción</th>
                        <th>Cliente</th>
                        <th>Fecha de creación</th>
                        <th>Fecha de pago</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transaccion in transacciones %}
                    <tr>
                        <td class="transaction-type">
                            {% if transaccion.tipo == 'COMPRA' %}
                                Compra {{ transaccion.moneda_destino.code }}
                            {% else %}
                                Venta {{ transaccion.moneda_origen.code }}
                            {% endif %}
                        </td>
                        <td class="client-name">{{ transaccion.cliente.nombre }}</td>
                        <td class="creation-date">{{ transaccion.fecha_creacion|date:"d-m-y" }}</td>
                        <td class="payment-date">
                            {% if transaccion.fecha_pago %}
                                {{ transaccion.fecha_pago|date:"d-m-y" }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td class="status-cell">
                            <div class="status-indicator {{ transaccion.estado|lower }}"></div>
                            <span class="status-text">{{ transaccion.get_estado_display }}</span>
                        </td>
                        <td class="actions-cell">
                            <button class="action-button view-data-btn" data-transaction-id="{{ transaccion.id }}">
                                Ver Datos
                            </button>
                            {% if transaccion.estado == 'PENDIENTE' %}
                                <button class="action-button cancel-btn" data-transaction-id="{{ transaccion.id }}">
                                    Cancelar
                                </button>
                            {% elif transaccion.estado == 'PAGADA' %}
                                <button class="action-button anular-btn" data-transaction-id="{{ transaccion.id }}">
                                    Anular
                                </button>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="no-transactions">No hay transacciones registradas.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
// Search functionality
document.getElementById('searchInput').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('.transactions-table tbody tr');
    
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        if (text.includes(searchTerm)) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
});

// Action buttons functionality (placeholder)
document.querySelectorAll('.action-button').forEach(button => {
    button.addEventListener('click', function() {
        const transactionId = this.getAttribute('data-transaction-id');
        const action = this.classList.contains('view-data-btn') ? 'Ver Datos' : 
                      this.classList.contains('cancel-btn') ? 'Cancelar' : 'Anular';
        
        console.log(`${action} transacción ${transactionId}`);
        // TODO: Implement actual functionality
    });
});
</script>
{% endblock %}