{% extends "webapp/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'webapp/css/compraventa/ingresar_pin.css' %}">
{% endblock %}

{% block content %}
<div class="pin-page-container">
  <!-- Messages -->
<!--{% if mensaje or messages %}
      {% if mensaje %}
          <div class="alert alert-error">{{ mensaje }}</div>
      {% endif %}

      {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}

      <script>
          setTimeout(() => {
              document.querySelectorAll('.alert').forEach(el => el.remove());
          }, 5000); // desaparecen en 5 segundos
      </script>
  {% endif %} -->
  <h4>Verificaci√≥n en dos pasos (MFA)</h4>
  <form method="post">
    {% csrf_token %}
    <p>Hemos enviado un c√≥digo de verificaci√≥n a tu correo electr√≥nico.</p>
    <input type="hidden" name="confirmar" value="1">
    {% for key, value in data.items %}
      <input type="hidden" name="{{ key }}" value="{{ value }}">
    {% endfor %}
    <div class="pin-form-wrapper">
      <label for="mfa_code" class="form-label">C√≥digo de verificaci√≥n</label>
      <input type="text" name="mfa_code" id="mfa_code" maxlength="6" class="form-control" required autofocus>
      <!-- Botones -->
      <div class="button-container">
        <button type="submit" name="confirmar">Verificar y continuar</button>
        <!-- ‚úÖ Sigue siendo bot√≥n submit, pero fuerza redirecci√≥n inmediata -->
        <button type="submit" name="cancelar" id="cancel-btn">Cancelar</button>
      </div>
    </div>
  </form>
</div>

<script>
  document.getElementById("cancel-btn").addEventListener("click", function(event) {
    event.preventDefault();           // ‚úã detiene el env√≠o real del formulario
    window.location.href = "{% url 'compraventa' %}";  // üåé redirige directo
  });
</script>
{% endblock %}
