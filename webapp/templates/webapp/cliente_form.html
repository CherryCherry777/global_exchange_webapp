{% extends "webapp/base.html" %}
{% load static %}
{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="admin-page-container create-client">
    <!-- Header moderno -->
    <div class="admin-header">
        <div class="header-content">
            <div class="header-left">
                <a href="{% url 'manage_clientes' %}" class="back-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Volver a Clientes
                </a>
                <h1 class="page-title">{{ title }}</h1>
                <p class="page-subtitle">Complete la información del cliente para registrarlo en el sistema</p>
            </div>
        </div>
    </div>

    <!-- Formulario -->
    <div class="form-container">
        <div class="form-card">
            <form method="POST" id="clienteForm">
                {% csrf_token %}
                
                <div class="form-grid">
                    <!-- Tipo de Cliente -->
                    <div class="form-group">
                        <label for="{{ form.tipoCliente.id_for_label }}" class="form-label">
                            {{ form.tipoCliente.label }}
                        </label>
                        {{ form.tipoCliente }}
                        {% if form.tipoCliente.errors %}
                            <div class="form-error">{{ form.tipoCliente.errors }}</div>
                        {% endif %}
                    </div>

                    <!-- Categoría -->
                    <div class="form-group">
                        <label for="{{ form.categoria.id_for_label }}" class="form-label">
                            {{ form.categoria.label }}
                        </label>
                        {{ form.categoria }}
                        {% if form.categoria.errors %}
                            <div class="form-error">{{ form.categoria.errors }}</div>
                        {% endif %}
                    </div>

                    <!-- Nombre -->
                    <div class="form-group">
                        <label for="{{ form.nombre.id_for_label }}" class="form-label">
                            {{ form.nombre.label }} <span class="required">*</span>
                        </label>
                        {{ form.nombre }}
                        {% if form.nombre.errors %}
                            <div class="form-error">{{ form.nombre.errors }}</div>
                        {% endif %}
                    </div>

                    <!-- Razón Social -->
                    <div class="form-group" id="razonSocialField">
                        <label for="{{ form.razonSocial.id_for_label }}" class="form-label">
                            {{ form.razonSocial.label }}
                        </label>
                        {{ form.razonSocial }}
                        {% if form.razonSocial.errors %}
                            <div class="form-error">{{ form.razonSocial.errors }}</div>
                        {% endif %}
                        <small class="form-help">Solo para personas jurídicas</small>
                    </div>

                    <!-- Documento -->
                    <div class="form-group">
                        <label for="{{ form.documento.id_for_label }}" class="form-label">
                            {{ form.documento.label }} <span class="required">*</span>
                        </label>
                        {{ form.documento }}
                        {% if form.documento.errors %}
                            <div class="form-error">{{ form.documento.errors }}</div>
                        {% endif %}
                    </div>

                    <!-- RUC -->
                    <div class="form-group" id="rucField">
                        <label for="{{ form.ruc.id_for_label }}" class="form-label">
                            {{ form.ruc.label }}
                        </label>
                        {{ form.ruc }}
                        {% if form.ruc.errors %}
                            <div class="form-error">{{ form.ruc.errors }}</div>
                        {% endif %}
                        <small class="form-help">Solo para personas jurídicas</small>
                    </div>

                    <!-- Correo -->
                    <div class="form-group">
                        <label for="{{ form.correo.id_for_label }}" class="form-label">
                            {{ form.correo.label }} <span class="required">*</span>
                        </label>
                        {{ form.correo }}
                        {% if form.correo.errors %}
                            <div class="form-error">{{ form.correo.errors }}</div>
                        {% endif %}
                    </div>

                    <!-- Teléfono -->
                    <div class="form-group">
                        <label for="{{ form.telefono.id_for_label }}" class="form-label">
                            {{ form.telefono.label }} <span class="required">*</span>
                        </label>
                        {{ form.telefono }}
                        {% if form.telefono.errors %}
                            <div class="form-error">{{ form.telefono.errors }}</div>
                        {% endif %}
                    </div>

                    <!-- Dirección -->
                    <div class="form-group full-width">
                        <label for="{{ form.direccion.id_for_label }}" class="form-label">
                            {{ form.direccion.label }} <span class="required">*</span>
                        </label>
                        {{ form.direccion }}
                        {% if form.direccion.errors %}
                            <div class="form-error">{{ form.direccion.errors }}</div>
                        {% endif %}
                    </div>

                    <!-- Estado -->
                    <div class="form-group full-width">
                        <div class="form-checkbox">
                            {{ form.estado }}
                            <label for="{{ form.estado.id_for_label }}" class="form-label">
                                {{ form.estado.label }}
                            </label>
                        </div>
                        {% if form.estado.errors %}
                            <div class="form-error">{{ form.estado.errors }}</div>
                        {% endif %}
                        <small class="form-help">Los clientes inactivos no podrán realizar operaciones</small>
                    </div>
                </div>

                <!-- Botones de Acción -->
                <div class="form-actions">
                    <a href="{% url 'manage_clientes' %}" class="modern-btn secondary-btn">
                        Volver a Clientes
                    </a>
                    
                    <button type="submit" class="modern-btn primary-btn" id="submitBtn">
                        {% if action == 'create' %}
                            Crear Cliente
                        {% else %}
                            Actualizar Cliente
                        {% endif %}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tipoClienteSelect = document.getElementById('{{ form.tipoCliente.id_for_label }}');
    const razonSocialField = document.getElementById('razonSocialField');
    const rucField = document.getElementById('rucField');
    
    // Función para mostrar/ocultar campos según el tipo de cliente
    function toggleFields() {
        if (tipoClienteSelect.value === 'persona_juridica') {
            razonSocialField.style.display = 'block';
            rucField.style.display = 'block';
        } else {
            razonSocialField.style.display = 'block';
            rucField.style.display = 'block';
        }
    }
    
    // Event listener para el cambio de tipo de cliente
    if (tipoClienteSelect) {
        tipoClienteSelect.addEventListener('change', toggleFields);
        toggleFields(); // Ejecutar al cargar la página
    }
    
    // Solución adicional para la visibilidad de opciones en selects
    function fixSelectOptions() {
        const selects = document.querySelectorAll('select');
        selects.forEach(select => {
            // Forzar estilos en las opciones
            const options = select.querySelectorAll('option');
            options.forEach(option => {
                option.style.backgroundColor = '#1a1a2e';
                option.style.color = '#ffffff';
                option.style.padding = '8px 12px';
            });
            
            // Asegurar que el select tenga el color correcto
            select.style.color = '#ffffff';
            select.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
        });
    }
    
    // Ejecutar la corrección al cargar y cuando se abra un select
    fixSelectOptions();
    
    // Re-ejecutar cuando se abra cualquier select
    document.addEventListener('click', function(e) {
        if (e.target.tagName === 'SELECT') {
            setTimeout(fixSelectOptions, 100);
        }
    });
    
    // También ejecutar cuando se haga focus en un select
    document.addEventListener('focus', function(e) {
        if (e.target.tagName === 'SELECT') {
            setTimeout(fixSelectOptions, 100);
        }
    }, true);
});
</script>
{% endblock %}
