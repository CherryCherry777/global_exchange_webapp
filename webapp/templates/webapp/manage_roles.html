{% extends "base.html" %}
{% load static %}

{% block title %}Manage Roles{% endblock %}

{% block content %}
<div class="homepage-container">
    <h1>Manage Roles</h1>

    <!-- Create new role -->
    <form method="post" action="{% url 'create_role' %}">
        {% csrf_token %}
        <input type="text" name="name" placeholder="New role name" required>
        <button type="submit" class="add-btn">Add Role</button>
    </form>

    <table class="roles-table">
        <thead>
            <tr>
                <th>Role</th>
                <th>Permissions</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for role in roles %}
            <tr>
                <td>{{ role.name }}</td>
                <td>
                    <form method="post" action="{% url 'update_role_permissions' role.id %}">
                        {% csrf_token %}
                        <select name="permissions" multiple size="5" class="role-select">
                            {% for perm in permissions %}
                                <option value="{{ perm.id }}" {% if perm in role.permissions.all %}selected{% endif %}>
                                    {{ perm.codename }}
                                </option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="add-btn">Update</button>
                    </form>
                </td>
                <td>
                    {% if role.name not in "Administrator,Employee,User" %}
                        <form method="post" action="{% url 'delete_role' role.id %}" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="add-btn" style="background-color:#e53935;">
                                Delete
                            </button>
                        </form>
                    {% else %}
                        <em>Protected</em>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
