{% extends "webapp/base.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}Modificar Usuario{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'webapp/css/usuarios/modify_user.css' %}">
{% endblock %}

{% block content %}
<div class="modify-user-container">
    <!-- Messages -->
    

    <!-- Header Section -->
    <div class="modify-user-header">
        <div class="main-content">
            <a href="{% url 'manage_users' %}" class="back-button">← Volver a Administrar Usuarios</a>
            
            <div class="header-content">
                <div class="header-text">
                    <h1 class="modify-user-title">Modificar Usuario</h1>
                    <p class="modify-user-subtitle">{{ user_obj.username }} - {{ user_obj.email }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Modify User Section -->
        <div class="modify-section">
            <h2 class="section-title">Información del Usuario</h2>
            
            <div class="modify-content">
                <!-- User Profile Section -->
                <div class="user-profile-section">
                    <div class="user-icon-circle">
                        <span>{{ user_obj.username|first|upper }}</span>
                    </div>
                </div>

                <!-- Form Container -->
                <div class="form-container">
                    <form method="POST" class="modify-form" id="modify-form">
                        {% csrf_token %}

                        <!-- Username and Email -->
                        <div class="form-row">
                            <div class="form-field">
                                <label class="field-label">Nombre de usuario</label>
                                <input id="username" name="username" type="text" class="form-input" value="{{ user_obj.username }}" required>
                            </div>
                            <div class="form-field">
                                <label class="field-label">Email</label>
                                <input id="email" name="email" type="email" class="form-input" value="{{ user_obj.email }}" required>
                            </div>
                        </div>

                        <!-- First and Last Name -->
                        <div class="form-row">
                            <div class="form-field">
                                <label class="field-label">Nombre</label>
                                <input id="first_name" name="first_name" type="text" class="form-input" value="{{ user_obj.first_name }}">
                            </div>
                            <div class="form-field">
                                <label class="field-label">Apellido</label>
                                <input id="last_name" name="last_name" type="text" class="form-input" value="{{ user_obj.last_name }}">
                            </div>
                        </div>

                        <!-- Active Status -->
                        <div class="form-row single-field-row">
                            <div class="form-field">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="is_active" class="checkbox-input" {% if user_obj.is_active %}checked{% endif %}>
                                    <span class="checkbox-text">Usuario Activo</span>
                                </label>
                            </div>
                        </div>

                        <!-- Roles Section -->
                        <div class="form-row">
                            <div class="form-field full-width">
                                <label class="field-label">Roles Asignados</label>
                                <div class="roles-container">
                                    {% for role in roles %}
                                    <label class="role-checkbox">
                                        <input type="checkbox" name="roles" value="{{ role.name }}" {% if role.name in user_roles %}checked="checked"{% endif %}>
                                        <span class="checkbox-custom"></span>
                                        <span class="checkbox-label">{{ role.name }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button type="submit" form="modify-form" class="save-button" style="width: fit-content;">Guardar Cambios</button>
                    
                    <button type="submit" form="modify-form" name="delete" value="1" class="delete-button" style="width: fit-content;">
                        Eliminar Usuario
                    </button>
                    
                    <a href="{% url 'manage_users' %}" class="discard-button">Descartar</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JS: Auto-hide messages -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(alert => {
        setTimeout(() => {
            alert.style.animation = 'slideOut 0.3s ease-in forwards';
            setTimeout(() => {
                alert.remove();
            }, 300);
        }, 5000);
    });
});
</script>

<style>
@keyframes slideOut {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
}
</style>
{% endblock %}
