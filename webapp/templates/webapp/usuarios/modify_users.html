{% extends "webapp/base.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}Modificar Usuario{% endblock %}

{% block extra_css %}
{% endblock %}

{% block content %}
<div class="modify-user-container">
    <!-- Back Button -->
    <div class="back-container">
        <a href="{% url 'manage_users' %}" class="back-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
            Volver a Usuarios
        </a>
    </div>

    <!-- Modify User Form -->
    <div class="modify-user-modal">
        <!-- Messages -->
        {% if messages %}
        <div class="messages-container">
            {% for message in messages %}
            <div class="message message-{{ message.tags }}">
                <div class="message-icon">
                    {% if message.tags == 'error' %}
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="15" y1="9" x2="9" y2="15"/>
                            <line x1="9" y1="9" x2="15" y2="15"/>
                        </svg>
                    {% elif message.tags == 'success' %}
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22,4 12,14.01 9,11.01"/>
                        </svg>
                    {% else %}
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="16" x2="12" y2="12"/>
                            <line x1="12" y1="8" x2="12.01" y2="8"/>
                        </svg>
                    {% endif %}
                </div>
                <span>{{ message }}</span>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="modal-header">
            <div class="user-avatar-large">
                <span>{{ user_obj.username|first|upper }}</span>
            </div>
            <h1 class="modal-title">Modificar Usuario</h1>
            <p class="modal-subtitle">{{ user_obj.username }} - {{ user_obj.email }}</p>
        </div>
        
        <form method="POST" class="modify-form">
            {% csrf_token %}
            
            <!-- Username Field -->
            <div class="form-group">
                <label for="username" class="form-label">Nombre de usuario</label>
                <input id="username" name="username" type="text" class="form-input" value="{{ user_obj.username }}" required />
            </div>

            <!-- Email Field -->
            <div class="form-group">
                <label for="email" class="form-label">Email</label>
                <input id="email" name="email" type="email" class="form-input" value="{{ user_obj.email }}" required />
            </div>

            <!-- Name Fields Row -->
            <div class="form-row">
                <div class="form-group">
                    <label for="first_name" class="form-label">Nombre</label>
                    <input id="first_name" name="first_name" type="text" class="form-input" value="{{ user_obj.first_name }}" />
                </div>
                <div class="form-group">
                    <label for="last_name" class="form-label">Apellido</label>
                    <input id="last_name" name="last_name" type="text" class="form-input" value="{{ user_obj.last_name }}" />
                </div>
            </div>

            <!-- User Status -->
            <div class="form-group">
                <label class="form-label">Estado del Usuario</label>
                <div class="status-display">
                    <span class="status-indicator {% if user_obj.is_active %}active{% else %}inactive{% endif %}"></span>
                    <span class="status-text">{% if user_obj.is_active %}Usuario Activo{% else %}Usuario Inactivo{% endif %}</span>
                </div>
            </div>

            <!-- Roles Section -->
            <div class="form-group roles-section">
                <label class="roles-label">Roles Asignados</label>
                <div class="roles-container">
                    {% for role in roles %}
                    <label class="role-checkbox">
                        <input type="checkbox" name="roles" value="{{ role.name }}" {% if role.name in user_roles %}checked="checked"{% endif %}>
                        <span class="checkbox-custom"></span>
                        <span class="checkbox-label">{{ role.name }}</span>
                    </label>
                    {% endfor %}
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <button type="submit" class="action-btn save-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17,21 17,13 7,13 7,21"/>
                        <polyline points="7,3 7,8 15,8"/>
                    </svg>
                    Guardar Cambios
                </button>
                
                <button type="submit" name="delete" value="1" class="action-btn delete-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3,6 5,6 21,6"/>
                        <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"/>
                        <line x1="10" y1="11" x2="10" y2="17"/>
                        <line x1="14" y1="11" x2="14" y2="17"/>
                    </svg>
                    Eliminar Usuario
                </button>
                
                <a href="{% url 'manage_users' %}" class="action-btn cancel-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                    Cancelar
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
