{% extends 'webapp/base.html' %}

{% load static %}

{% load permissions_tags %}

{% block title %}Panel de Administración{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'webapp/admin.css' %}" />
<link rel="stylesheet" href="{% static 'webapp/user_dashboard.css' %}" />
{% endblock %}

{% block content %}
{% has_perms request.user 'webapp.access_admin_panel' as can_access_admin_panel %}
{% if can_access_admin_panel %}
<div class="admin-panel">
    <!-- Header Section -->
    <div class="admin-header">
        <h1 class="admin-title">Panel de administración</h1>
        <p class="admin-subtitle">Gestión centralizada del sistema Global Exchange</p>
    </div>

    <!-- Metrics Section -->
    <div class="admin-metrics">
        <div class="metric-card">
            <div class="metric-label">Usuarios Activos</div>
            <div class="metric-number">{{ usuarios_activos }}</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Monedas Activas</div>
            <div class="metric-number">{{ monedas_activas }}</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Clientes Activos</div>
            <div class="metric-number">{{ clientes_activos }}</div>
        </div>
    </div>

    <!-- Management Buttons Grid -->
    <div class="admin-grid">
        {% has_perms request.user 'webapp.view_customuser' as can_view_customuser %}
        {% if can_view_customuser %}
        <!-- Primera Columna -->
        <a href="{% url 'manage_users' %}" class="admin-card">
            <div class="card-icon">
                <img src="{% static 'webapp/panel_gestiones/1.Administar_Usuarios.png' %}" alt="Administrar Usuarios">
            </div>
            <div class="card-content">
                <h3 class="card-title">Administrar Usuarios</h3>
            </div>
        </a>
        {% endif %}
        {% has_perms request.user 'webapp.view_clienteusuario' as can_view_clienteusuario %}
        {% if can_view_clienteusuario %}
        <a href="{% url 'assign_clients' %}" class="admin-card">
            <div class="card-icon">
                <img src="{% static 'webapp/panel_gestiones/4.Asignar_Clientes_a_Usuarios.png' %}" alt="Asignar Clientes a Usuarios">
            </div>
            <div class="card-content">
                <h3 class="card-title">Asignar Clientes a Usuarios</h3>
            </div>
        </a>
        {% endif %}
        {% has_perms request.user 'webapp.view_categoria' as can_view_categoria %}
        {% if can_view_categoria %}
        <a href="{% url 'manage_categories' %}" class="admin-card">
            <div class="card-icon">
                <img src="{% static 'webapp/panel_gestiones/7.Administrar_Categorias.png' %}" alt="Administrar Categorías">
            </div>
            <div class="card-content">
                <h3 class="card-title">Administrar Categorías</h3>
            </div>
        </a>
        {% endif %}
        {% has_perms request.user 'webapp.view_mediopago' as can_view_mediopago %}
        {% if can_view_mediopago %}
        <a href="{% url 'manage_payment_methods' %}" class="admin-card">
            <div class="card-icon">
                <img src="{% static 'webapp/panel_gestiones/10.Administrar_Metodos_de_Pago_Globales.png' %}" alt="Administrar Métodos de Pago Globales">
            </div>
            <div class="card-content">
                <h3 class="card-title">Administrar Métodos de Pago Globales</h3>
            </div>
        </a>
        {% endif %}
        {% has_perms request.user 'webapp.view_limiteintercambio' as can_view_limiteintercambio %}
        {% if can_view_limiteintercambio %}
        <a href="{% url 'limites_list' %}" class="admin-card">
            <div class="card-icon">
                <img src="{% static 'webapp/panel_gestiones/13. Administrar_Limites_de_Intercambio.png' %}" alt="Administrar Límites de Intercambio">
            </div>
            <div class="card-content">
                <h3 class="card-title">Administrar Límites de Intercambio</h3>
            </div>
        </a>
        {% endif %}
        <!-- Segunda Columna -->
        {% has_perms request.user 'webapp.view_role' as can_view_role %}
        {% if can_view_role %}
        <a href="{% url 'manage_roles' %}" class="admin-card">
            <div class="card-icon">
                <img src="{% static 'webapp/panel_gestiones/2.Administrar_Roles.png' %}" alt="Administrar Roles">
            </div>
            <div class="card-content">
                <h3 class="card-title">Administrar Roles</h3>
            </div>
        </a>
        {% endif %}
        {% has_perms request.user 'webapp.view_cliente' as can_view_cliente %}
        {% if can_view_cliente %}
        <a href="{% url 'manage_clientes' %}" class="admin-card">
            <div class="card-icon">
                <img src="{% static 'webapp/panel_gestiones/5.Administrar_Clientes.png' %}" alt="Administrar Clientes">
            </div>
            <div class="card-content">
                <h3 class="card-title">Administrar Clientes</h3>
            </div>
        </a>
        {% endif %}
        {% has_perms request.user 'webapp.view_currency' as can_view_currency %}
        {% if can_view_currency %}
        <a href="{% url 'manage_quotes' %}" class="admin-card">
            <div class="card-icon">
                <img src="{% static 'webapp/panel_gestiones/8.Administrar_Cotizaciones.png' %}" alt="Administrar Cotizaciones">
            </div>
            <div class="card-content">
                <h3 class="card-title">Administrar Cotizaciones</h3>
            </div>
        </a>
        {% endif %}
        <!-- Tercera Columna -->
        {% has_perms request.user 'webapp.view_customuser' 'webapp.view_role' as can_view_customuser_role %}
        {% if can_view_customuser_role %}
        <a href="{% url 'manage_user_roles' %}" class="admin-card">
            <div class="card-icon">
                <img src="{% static 'webapp/panel_gestiones/3.Administar_Roles_de_Usuarios.png' %}" alt="Administrar Roles de Usuarios">
            </div>
            <div class="card-content">
                <h3 class="card-title">Administrar Roles de Usuarios</h3>
            </div>
        </a>
        {% endif %}
        {% has_perms request.user 'webapp.view_currency' as can_view_currency %}
        {% if can_view_currency %}
        <a href="{% url 'manage_currencies' %}" class="admin-card">
            <div class="card-icon">
                <img src="{% static 'webapp/panel_gestiones/6.Administrar_Monedas.png' %}" alt="Administrar Monedas">
            </div>
            <div class="card-content">
                <h3 class="card-title">Administrar Monedas</h3>
            </div>
        </a>
        {% endif %}
        {% has_perms request.user 'webapp.view_mediocobro' as can_view_mediocobro %}
        {% if can_view_mediocobro %}
        <a href="{% url 'manage_cobro_methods' %}" class="admin-card">
            <div class="card-icon">
                <img src="{% static 'webapp/panel_gestiones/12.Administrar_Metodos_de_Acreditacion_Globales.png' %}" alt="Administrar Métodos de Cobro Globales">
            </div>
            <div class="card-content">
                <h3 class="card-title">Administrar Métodos de Cobro Globales</h3>
            </div>
        </a>
        {% endif %}
        <a href="{% url 'entidad_list' %}" class="admin-card">
            <div class="card-icon">
                <img src="{% static 'webapp/panel_gestiones/12.Administrar_Metodos_de_Acreditacion_Globales.png' %}" alt="Administrar Métodos de Cobro Globales">
            </div>
            <div class="card-content">
                <h3 class="card-title">Administrar Entidades de Pago/Cobro</h3>
            </div>
        </a>
        <a href="{% url 'manage_schedule' %}" class="admin-card">
            <div class="card-icon">
                <img src="{% static 'webapp/panel_gestiones/3.Administar_Roles_de_Usuarios.png' %}" alt="Administrar Roles de Usuarios">
            </div>
            <div class="card-content">
                <h3 class="card-title">Administrar frecuencia de correos global</h3>
            </div>
        </a>

    </div>
</div>
{% else %}
<div class="user-dashboard-container">
    <!-- Header Section -->
    <div class="user-dashboard-header">
        <div class="main-content">
            <div class="header-content">
                <div class="header-text">
                    <h1 class="user-dashboard-title">Bienvenido a Global Exchange!</h1>
                    <p class="user-dashboard-subtitle">Proveemos el mejor servicio de cambio de monedas</p>
                </div>
                
                <!-- Quick Actions -->
                <div class="quick-actions">
                    <a href="{% url 'public_home' %}" class="quick-action-btn">
                        <div class="btn-icon">
                            <img src="{% static 'webapp/panel_gestiones/1.Administar_Usuarios.png' %}" alt="Inicio">
                        </div>
                        <span class="btn-text">Ir al Inicio</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        {% is_usuario_asociado request.user as usuario_asociado %}
        {% if usuario_asociado %}
        <!-- User Management Section -->
        <div class="user-management-section">
            <h2 class="section-title">Gestiona tus Métodos de Pago y Cobro</h2>
            <p class="section-subtitle">Administra tus métodos de pago y cobro personales</p>
            
            <div class="user-management-grid">
                <a href="{% url 'my_payment_methods' %}" class="user-management-card payment-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <img src="{% static 'webapp/panel_gestiones/9.Administrar_Metodos_de_Pago.png' %}" alt="Métodos de Pago">
                        </div>
                        <div class="card-badge payment-badge">Pago</div>
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Administrar Métodos de Pago</h3>
                        <p class="card-description">Gestiona tus billeteras, cuentas bancarias y tarjetas para realizar pagos</p>
                        <div class="card-features">
                            <span class="feature-tag">Billeteras</span>
                            <!--<span class="feature-tag">Cuentas Bancarias</span>-->
                            <span class="feature-tag">Tarjetas</span>
                        </div>
                    </div>
                    <div class="card-arrow">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                </a>

                <a href="{% url 'my_cobro_methods' %}" class="user-management-card cobro-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <img src="{% static 'webapp/panel_gestiones/11.Administrar_Metodos_de_Cobro.png' %}" alt="Métodos de Cobro">
                        </div>
                        <div class="card-badge cobro-badge">Cobro</div>
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Administrar Métodos de Cobro</h3>
                        <p class="card-description">Configura tus métodos para recibir pagos y transferencias</p>
                        <div class="card-features">
                            <span class="feature-tag">Billeteras</span>
                            <span class="feature-tag">Cuentas Bancarias</span>
                            <!--<span class="feature-tag">Tarjetas</span>-->
                        </div>
                    </div>
                    <div class="card-arrow">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                </a>
            </div>
        </div>
        {% else %}
        <!-- No Associated User Message -->
        <div class="no-access-section">
            <div class="no-access-content">
                <div class="no-access-icon">
                    <img src="{% static 'webapp/panel_gestiones/1.Administar_Usuarios.png' %}" alt="Sin Acceso">
                </div>
                <h2 class="no-access-title">No tienes acceso a funciones de usuario</h2>
                <p class="no-access-description">Contacta con un administrador para obtener acceso a las funciones de gestión de métodos de pago y cobro.</p>
                <a href="{% url 'public_home' %}" class="no-access-btn">Volver al Inicio</a>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}
{% endblock %}
