{% extends "webapp/base.html" %}
{% load static %}
{% load permissions_tags %}
{% block messages %}{% endblock %}

{% block title %}Gestión de Clientes{% endblock %}

{% has_perms user 'webapp.view_cliente' as can_view_clientes %}
{% if can_view_clientes %}
{% block content %}
<h1>Gestión de Clientes</h1>


<!-- Barra de acciones -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
    <div style="display: flex; gap: 10px; align-items: center;">
        <!-- Botones siempre visibles para administradores -->
        <a href="{% url 'create_cliente' %}" class="add-btn" style="padding: 12px 24px; background-color: #4CAF50; color: white; border-radius: 8px; text-decoration: none; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.2); font-size: 16px;">
            + Crear Cliente
        </a>
    </div>

    <input 
        type="text" 
        id="clienteSearch" 
        placeholder="Buscar cliente por nombre, documento o correo..." 
        style="padding: 8px 12px; width: 300px; border-radius: 6px; border: 2px solid #ddd; font-size: 14px;"
    >
</div>

<!-- Tabla de clientes -->
<table class="clientes-table" id="clientesTable">
    <thead>
        <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Razón Social</th>
            <th>Tipo</th>
            <th>Documento</th>
            <th>RUC</th>
            <th>Correo</th>
            <th>Teléfono</th>
            <th>Dirección</th>
            <th>Categoría</th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for cliente in clientes %}
        <tr>
            <td>{{ cliente.id }}</td>
            <td>{{ cliente.nombre }}</td>
            <td>{{ cliente.razonSocial }}</td>
            <td>{{ cliente.get_tipoCliente_display }}</td>
            <td>{{ cliente.documento }}</td>
            <td>{{ cliente.ruc }}</td>
            <td>{{ cliente.correo }}</td>
            <td>{{ cliente.telefono }}</td>
            <td>{{ cliente.direccion }}</td>
            <td>{{ cliente.get_categoria_display }}</td>
            <td>
                {% if cliente.estado %}
                    <span class="role-badge">Activo</span>
                {% else %}
                    <span class="no-role">Inactivo</span>
                {% endif %}
            </td>
            <td>
                <!-- Botón para ver detalles -->
                <a href="{% url 'view_cliente' cliente.id %}" 
                   class="add-btn" 
                   style="background-color: #3498db; padding: 5px 8px; border-radius: 4px; color: white; text-decoration: none; margin-right: 5px;">
                    Ver
                </a>
                
                <!-- Botón para modificar cliente -->
                <a href="{% url 'update_cliente' cliente.id %}" 
                   class="add-btn" 
                   style="background-color: #f39c12; padding: 5px 8px; border-radius: 4px; color: white; text-decoration: none; margin-right: 5px;">
                    Editar
                </a>

                <!-- Botón para eliminar -->
                <a href="{% url 'delete_cliente' cliente.id %}" 
                   class="add-btn" 
                   style="background-color: #e74c3c; padding: 5px 8px; border-radius: 4px; color: white; text-decoration: none;">
                    Eliminar
                </a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="12" style="text-align:center;">
                <div style="padding: 40px;">
                    <h3 style="color: #666; margin-bottom: 20px;">No hay clientes registrados</h3>
                    <p style="color: #888; margin-bottom: 30px;">Comienza agregando tu primer cliente al sistema</p>
                    <a href="{% url 'create_cliente' %}" class="add-btn" style="padding: 12px 24px; background-color: #4CAF50; color: white; border-radius: 8px; text-decoration: none; font-size: 16px; font-weight: bold;">
                        + Crear Primer Cliente
                    </a>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Script para el buscador -->
<script>
document.getElementById("clienteSearch").addEventListener("keyup", function() {
    let value = this.value.toLowerCase();
    let rows = document.querySelectorAll("#clientesTable tbody tr");

    rows.forEach(function(row) {
        let text = row.innerText.toLowerCase();
        row.style.display = text.includes(value) ? "" : "none";
    });
});
</script>


<style>
/* Mejorar el estilo de los botones */
.add-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
}

</style>

{% endblock %}
{% endif %}
